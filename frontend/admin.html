<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phoenix Admin Dashboard</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
      background: #0b0b0b;
      color: white;
    }

    h1 {
      color: #d4af37;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
      background: #111;
    }

    th, td {
      border: 1px solid #333;
      padding: 12px;
      text-align: left;
    }

    th {
      background: #1a1a1a;
      color: #d4af37;
    }

    button {
      padding: 6px 14px;
      background: #d4af37;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    .paid {
      color: #00ff99;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h1>üìä Phoenix Admin Dashboard</h1>
<p>Total Users: <b id="count">Loading...</b></p>

<table>
  <thead>
    <tr>
      <th>Email</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="list"></tbody>
</table>

<script>
const API = "https://distress-backend-sj8y.onrender.com";
const ADMIN_KEY = "phoenix-2025"; // MUST match Render ENV

async function loadUsers() {
  const res = await fetch(API + "/admin/users", {
    headers: {
      "x-admin-key": ADMIN_KEY
    }
  });

  if (!res.ok) {
    document.body.innerHTML = "<h2>‚ùå Unauthorized</h2>";
    return;
  }

  const users = await res.json();
  document.getElementById("count").innerText = users.length;

  const tbody = document.getElementById("list");
  tbody.innerHTML = "";

  users.forEach(u => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${u.email}</td>
      <td class="${u.status === "PAID" ? "paid" : ""}">
        ${u.status}
      </td>
      <td>
        ${
          u.status === "PAID"
            ? "‚Äî"
            : `<button onclick="approve('${u.email}')">Approve</button>`
        }
      </td>
    `;

    tbody.appendChild(tr);
  });
}

async function approve(email) {
  await fetch(API + "/admin/approve", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "x-admin-key": ADMIN_KEY
    },
    body: JSON.stringify({ email })
  });

  loadUsers();
}

loadUsers();
</script>

</body>
</html>
